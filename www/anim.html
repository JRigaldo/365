<!DOCTYPE html>
<html>
    <head>
        <title>API exploitation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="jquery-ui.min.js"></script>
        <script>
            
        var particulesSize      = 5;
        var easeInspiration     = 'easeOutCubic';
        var dureeInspiration    = 6500;
        var easeExpiration      = 'easeOutCubic';
        var dureeExpiration     = 3500;
        var dureeAttente        = 3500;
            
            
        $(window).on('load', function()
        {   
            animateParticules();
        });
            
        $(window).on('resize', function()
        {   
            animateParticules();
        });
            
            
        var animdist        = 0;
            
        var particuleIsSet  = false;
            
        var particules      = null;
            
        var particulesPosition = [];
        
        var animcycle = function( o, l, t )
        {
            $('div.particulemeter > span').stop().css({left:0});
            $('div.particulemeter > span').animate({left:400}, dureeInspiration, easeInspiration); 
            o.animate({left:( l * animdist ), top:( t * animdist )}, dureeInspiration, easeInspiration, function()
            {
                $('div.particulemeter > span').stop();
                $('div.particulemeter > span').animate({left:0}, dureeExpiration, easeExpiration); 
                o.animate({left:( l ), top:( t )}, dureeExpiration, easeExpiration, function()
                {
                    $('div.particulemeter > span').stop().animate({opacity:0}, (dureeAttente / 2), function(){
                        $('div.particulemeter > span').animate({opacity:1}, (dureeAttente / 2));
                    });
                    setTimeout( function(){ animcycle( o, l, t ) }, dureeAttente );
                });
            });
        }
        
            
        var animateParticules = function()
        {
            var wWidth = $(window).width();
            
            animdist = wWidth / 50;
            
            if( !particuleIsSet )
            {  
                particules = $('div.particules > span');

                particules.css({width:particulesSize, height:particulesSize});
            } 
            
            $.each( particules, function( k, v)
            {  
                if( !particuleIsSet )
                { 
                    var posLeft = $(this).data('posleft');
                    var posTop  = $(this).data('postop');

                    particulesPosition[k] = {obj:$(this), posLeft:posLeft, posTop:posTop};
                }
                
                $(this).css({left:particulesPosition[k].posLeft, top:particulesPosition[k].posTop});
            });
            
            particuleIsSet = true;
            
            $.each( particulesPosition, function( k, v)
            {    
                var l = particulesPosition[k].posLeft;
                var t = particulesPosition[k].posTop;
                var o = particulesPosition[k].obj;
                o.stop();
                animcycle( o, l, t );
            });
        } 
        </script>
        <style>
            *{box-sizing:border-box;}
            body{margin:0; padding:0;}
            main{width: 100%; height:100vh}
            div.particules{width:10px; height:10px; position:absolute; top:0px; right:0px; bottom:0px; left:0px; margin:auto;}
            div.particules > span{display:block; background:rgba(0, 0, 0, 0.5); position: absolute; left:-10px; top:-10px; border-radius:50%;}
            
            div.particulemeter{width:400px; height:1px; background:rgba(0, 0, 0, 0.5); position:relative; margin:30px auto;}
            div.particulemeter > span{display:block; width:5px; height:11px; position: absolute; left:0px; top:-5px; background:rgba(0, 0, 0, 0.9); }
   
        </style>
    </head>
    <body>
        <main>
            <div class="particulemeter"><span></span></div>
        
            <div class="particules">
                <span data-posleft="-5" data-postop="-5"></span>
                <span data-posleft="5" data-postop="-5"></span>
                <span data-posleft="-5" data-postop="5"></span>
                <span data-posleft="1" data-postop="8"></span>
                <span data-posleft="-12" data-postop="-7"></span>
                <span data-posleft="0" data-postop="-1"></span>
                <span data-posleft="14" data-postop="-6"></span>
                <span data-posleft="-1" data-postop="-11"></span>
                <span data-posleft="6" data-postop="-11"></span>
                <span data-posleft="14" data-postop="2"></span>
                <span data-posleft="-10" data-postop="12"></span>
                <span data-posleft="-12" data-postop="2"></span>
                <span data-posleft="8" data-postop="10"></span>
                <span data-posleft="7" data-postop="1"></span>
            </div>
            
        </main>
    </body>
</html>
